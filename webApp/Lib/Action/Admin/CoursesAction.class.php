<?phpclass CoursesAction extends Action{	//选课指导或流程	public function guideAndProcess(){		$guidancepro = M('guidanceprocess');		if(0 == $_GET['gptype']){//选课指导			$result = $guidancepro->where("type=0")->find();			$this->assign('gp',$result);			$this->display('selectionGuide');		}else{//1 选课流程			$result = $guidancepro->where("type=1")->find();			$this->assign('gp',$result);			$this->display('selectionProcess');		}	}		//更新选课指导或流程	public function doUpdateGuideProcess(){		R('Admin/Authority/checkAdminLogin');//表示调用Admin分组下Authority模块的checkAdminLogin方法				$gpid = $_POST['gpid'];		$type = $_POST['gptype'];		$data['subject'] = $_POST['subject'];		$data['content'] = $_POST['content'];				$guidancepro = M('guidanceprocess');		if(null == $gpid){//创建选课指导或流程			$data['type'] = $type;			if($guidancepro->add($data))				$this->success('创建成功！');			else				$this->error('创建失败！');		}else{//修改原有的选课指导或流程			if($guidancepro->where("gpid=$gpid")->save($data))				$this->success('更新成功！');			else				$this->error('更新失败！');		}	}		//课程列表	public function courseslist(){		$courses = M('courses');		$result = $courses->select();		$this->assign('courseslist',$result);		$this->display('coursesList');	}		//获取课程详细信息	public function getCourseDetail(){		$cid = $_GET['cid'];		$courses = M('courses');		$result = $courses->where("cid = $cid")->find();		$this->assign('c',$result);		$this->display('courseDetail');	}		//更新课程信息	public function doUpdateCourse(){		R('Admin/Authority/checkAdminLogin');//表示调用Admin分组下Authority模块的checkAdminLogin方法		$cid = $_POST['cid'];		$data['coursename'] = $_POST['coursename'];		$data['teacher'] = $_POST['teacher'];		$data['place'] = $_POST['place'];		$data['headcount'] = $_POST['headcount'];		$data['ispublic'] = $_POST['ispublic'];		$data['introduction'] = $_POST['cintroduction'];		$data['hoursarrangement'] = $_POST['hoursarrangement'];				$courses = M('courses');		if(null == $cid){//创建新的课程			if(($res=$courses->add($data)))				$this->success('创建课程成功！',"getCourseDetail/cid/$res");			else				$this->error('创建课程失败！');		}else{//修改原有的课程			if($courses->where("cid = $cid")->save($data))				$this->success('更新课程信息成功！');			else				$this->error('更新课程信息失败！');		}	}		//批量发布课程	public function doPubliccourses(){		R('Admin/Authority/checkAdminLogin');//表示调用Admin分组下Authority模块的checkAdminLogin方法				$cids = $_POST['cids'];		$courses = M('courses');		$data['ispublic'] = 1;				for($i=0;$i<count($cids);$i++){			if(!$courses->where('cid='.$cids[$i])->save($data))				$this->error('批量发布失败！');		}		$this->success('批量发布成功！');	}		public function selectionMembers(){		$queryStr = "SELECT ccid,coursename,sname,headcount,status FROM curriculum,courses,student WHERE student.sid=stuid AND cid=courseid ORDER BY courseid";		$model = new Model();	    $list = $model->query($queryStr);				$this->assign('selectionlist',$list);		$this->display('selectionMemberList');	}		//批量通过或拒绝学生的选课	public function doPassOrRejectSelection(){		R('Admin/Authority/checkAdminLogin');//表示调用Admin分组下Authority模块的checkAdminLogin方法				$passOrReject = $_POST['passOrReject'];		$ccids = $_POST['ccids'];				$curriculum = M('curriculum');		if(1 == $passOrReject){//通过			$data['status'] = '通过';			for($i=0;$i<count($ccids);$i++){				if(!$curriculum->where('ccid='.$ccids[$i])->save($data))					$this->error('批量通过失败！');			}			$this->success('批量通过成功！');		}else{//0 拒绝			for($i=0;$i<count($ccids);$i++){				if(!$curriculum->where('ccid='.$ccids[$i])->delete())					$this->error('批量拒绝失败！');			}			$this->success('批量拒绝成功！');		}			}		public function coursesForMarks(){		$courses = M('courses');		$result = $courses->select();		$this->assign('courseslist',$result);		$this->display('coursesForMarksList');	}		public function getSelectedMembers(){		R('Admin/Authority/checkAdminLogin');//表示调用Admin分组下Authority模块的checkAdminLogin方法				$cid = $_GET['cid'];		$cname=$_GET['cname'];		$queryStr = "SELECT ccid,sname,mark FROM curriculum,student WHERE courseid = $cid and sid = stuid order by sname";		$model = new Model();	    $list = $model->query($queryStr);				$this->assign('cname',$cname);		$this->assign('memberList',$list);		$this->display('stuMarksOfACourse');	}		public function doUpdateMarks(){		R('Admin/Authority/checkAdminLogin');//表示调用Admin分组下Authority模块的checkAdminLogin方法				$ccids = $_POST['ccids'];		$marks = $_POST['cmarks'];		$curriculum = M('curriculum');		for($i=0;$i<count($ccids);$i++){			$data['mark'] = $marks[$i];			if(!$curriculum->where('ccid='.$ccids[$i])->save($data))				$this->error('提交课程成绩失败！');		}		$this->success('提交课程成绩成功！');	}}?>